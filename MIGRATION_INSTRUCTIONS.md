# Инструкция по миграции базы данных

## Добавление поля target_fish_kinds в таблицу trainings

Для интеграции системы целевой рыбы необходимо выполнить миграцию базы данных в Supabase.

### Шаг 1: Открыть SQL Editor в Supabase

1. Войдите в панель управления Supabase
2. Перейдите в раздел "SQL Editor"
3. Создайте новый запрос

### Шаг 2: Выполнить SQL-скрипт

Скопируйте и выполните следующий SQL-код:

```sql
-- Миграция для добавления поля target_fish_kinds в таблицу trainings
-- Выполнить в Supabase SQL Editor

-- Добавляем поле target_fish_kinds как массив UUID (для ID видов целевой рыбы)
ALTER TABLE trainings
ADD COLUMN IF NOT EXISTS target_fish_kinds UUID[] DEFAULT NULL;

-- Добавляем комментарий к полю
COMMENT ON COLUMN trainings.target_fish_kinds IS 'Массив ID видов целевой рыбы для тренировки';

-- Создаем индекс для быстрого поиска по целевой рыбе (опционально)
CREATE INDEX IF NOT EXISTS idx_trainings_target_fish_kinds
ON trainings USING GIN (target_fish_kinds);

-- Проверяем текущую структуру таблицы
SELECT column_name, data_type, is_nullable, column_default
FROM information_schema.columns
WHERE table_name = 'trainings'
ORDER BY ordinal_position;
```

### Шаг 3: Проверка результата

После выполнения скрипта вы должны увидеть:

- Новое поле `target_fish_kinds` типа `UUID[]` в таблице `trainings`
- Комментарий к полю
- Индекс для оптимизации поиска

### Шаг 4: Проверка существующих данных

Выполните запрос для проверки:

```sql
-- Проверяем текущие тренировки
SELECT id, title, target_fish_kinds
FROM trainings
LIMIT 10;
```

Все существующие тренировки должны иметь значение `NULL` в поле `target_fish_kinds`.

### Что дает эта миграция:

1. **Новое поле**: `target_fish_kinds` - массив ID видов целевой рыбы
2. **Тип данных**: `UUID[]` - массив UUID для совместимости с существующими справочниками
3. **Значение по умолчанию**: `NULL` - для существующих тренировок
4. **Индекс**: GIN индекс для быстрого поиска по массиву
5. **Обратная совместимость**: существующие тренировки продолжат работать

### После миграции:

- При создании новых тренировок можно будет указывать целевые виды рыбы
- В существующих тренировках поле будет пустым (`NULL`)
- Система автоматически адаптируется к новому полю
- Статистика будет включать анализ по целевой рыбе

### Безопасность:

- Миграция использует `IF NOT EXISTS` - безопасна для повторного выполнения
- Существующие данные не изменяются
- Новое поле не влияет на текущую функциональность
